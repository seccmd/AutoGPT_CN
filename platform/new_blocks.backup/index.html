
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.agpt.co/platform/new_blocks.backup/">
      
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Contributing to AutoGPT Agent Server: Creating and Testing Blocks - AutoGPT 中文版</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-3CKX8MZFEY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-3CKX8MZFEY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-3CKX8MZFEY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
<style>
  svg.ms-w-12 {
    width: 2rem !important;
  }
  svg.ms-h-12 {
    height: 2rem !important;
  }
  /* Temporary solution for the font sizes  */
  #headlessui-dialog-panel-2 p{
    font-size: 16px;
  }
  #headlessui-dialog-panel-2 textarea{
    font-size: 16px;
  }
  #headlessui-dialog-panel-2 span{
    font-size: 14px;

  }
  #headlessui-dialog-panel-2 div{
    font-size: 16px;
  }
  #headlessui-dialog-panel-2 a{
    font-size: 14px;
    line-height: 1rem;
  }
  #headlessui-dialog-panel-2 button{
    border: 1px solid #0000001d;
    line-height: 1rem;

}
  /* Temporary solution for the font size  */
  #headlessui-dialog-panel-2 > div > div > div > div.ms-w-full.ms-rounded-xl.ms-flex.ms-flex-col.ms-relative > div > div > div > div > div.ms-flex.ms-flex-row.ms-items-center.ms-justify-between.ms-gap-1 > p{
    font-size: 14px;
    line-height: 1rem;
  }

</style>

<div id="my-component-root" class="mendable-search"></div>

<script src="https://unpkg.com/@mendable/search@0.0.155/dist/umd/mendable-bundle.min.js"></script>

<script>
    Mendable.initialize({
      anon_key: 'a0bd44db-eb3b-412f-8924-b31c58244a64',
      type: 'floatingButton',
      style : { accentColor: '#3F51B5', darkMode: false },
      floatingButtonStyle:{
        backgroundColor: '#3F51B5',
        color: '#fff',
      },
      icon: "https://mendable-storage.s3.amazonaws.com/autoGPT.gif",
      botIcon: "https://mendable-storage.s3.amazonaws.com/autoGPTbot.gif",
    })
  </script>


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#contributing-to-autogpt-agent-server-creating-and-testing-blocks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AutoGPT 中文版" class="md-header__button md-logo" aria-label="AutoGPT 中文版" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21.5c-1.35-.85-3.8-1.5-5.5-1.5-1.65 0-3.35.3-4.75 1.05-.1.05-.15.05-.25.05-.25 0-.5-.25-.5-.5V6c.6-.45 1.25-.75 2-1 1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5.75.25 1.4.55 2 1v14.6c0 .25-.25.5-.5.5-.1 0-.15 0-.25-.05-1.4-.75-3.1-1.05-4.75-1.05-1.7 0-4.15.65-5.5 1.5M12 8v11.5c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5V7c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5m1 3.5c1.11-.68 2.6-1 4.5-1 .91 0 1.76.09 2.5.28V9.23c-.87-.15-1.71-.23-2.5-.23q-2.655 0-4.5.84zm4.5.17c-1.71 0-3.21.26-4.5.79v1.69c1.11-.65 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24v-1.5c-.87-.16-1.71-.23-2.5-.23m2.5 2.9c-.87-.16-1.71-.24-2.5-.24-1.83 0-3.33.27-4.5.8v1.69c1.11-.66 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AutoGPT 中文版
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Contributing to AutoGPT Agent Server: Creating and Testing Blocks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Significant-Gravitas/AutoGPT" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    AutoGPT
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/" class="md-tabs__link">
          
  
  The AutoGPT Platform 🆕

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../classic/" class="md-tabs__link">
          
  
  AutoGPT Classic

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contribute/" class="md-tabs__link">
        
  
    
  
  Contribute

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/LICENSE" class="md-tabs__link">
        
  
    
  
  License

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AutoGPT 中文版" class="md-nav__button md-logo" aria-label="AutoGPT 中文版" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21.5c-1.35-.85-3.8-1.5-5.5-1.5-1.65 0-3.35.3-4.75 1.05-.1.05-.15.05-.25.05-.25 0-.5-.25-.5-.5V6c.6-.45 1.25-.75 2-1 1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5.75.25 1.4.55 2 1v14.6c0 .25-.25.5-.5.5-.1 0-.15 0-.25-.05-1.4-.75-3.1-1.05-4.75-1.05-1.7 0-4.15.65-5.5 1.5M12 8v11.5c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5V7c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5m1 3.5c1.11-.68 2.6-1 4.5-1 .91 0 1.76.09 2.5.28V9.23c-.87-.15-1.71-.23-2.5-.23q-2.655 0-4.5.84zm4.5.17c-1.71 0-3.21.26-4.5.79v1.69c1.11-.65 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24v-1.5c-.87-.16-1.71-.23-2.5-.23m2.5 2.9c-.87-.16-1.71-.24-2.5-.24-1.83 0-3.33.27-4.5.8v1.69c1.11-.66 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24z"/></svg>

    </a>
    AutoGPT 中文版
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Significant-Gravitas/AutoGPT" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    AutoGPT
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    The AutoGPT Platform 🆕
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            The AutoGPT Platform 🆕
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup AutoGPT (Local-Host)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../edit-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Edit an Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../delete-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete an Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../download-agent-from-marketplace-local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download & Import and Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../create-basic-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a Basic Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../submit-agent-to-marketplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submit an Agent to the Marketplace
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent-blocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent Blocks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../new_blocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build your own Blocks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ollama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Ollama
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../d_id/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using D-ID
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blocks/blocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blocks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tests
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AutoGPT Classic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AutoGPT Classic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up AutoGPT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/setup/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set up with Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/setup/for-developers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    For Developers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_2_4" id="__nav_3_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/configuration/options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/configuration/search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/configuration/voice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voice
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Help us improve AutoGPT
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Help us improve AutoGPT
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/share-your-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Share your debug logs with us
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribution guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classic/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-of-conduct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Benchmark
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Benchmark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/classic/benchmark/README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Readme
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Forge
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Forge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/get-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_2" >
        
          
          <label class="md-nav__link" for="__nav_3_6_2" id="__nav_3_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6_2">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/agents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/protocols/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Protocols
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/built-in-components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built in Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forge/components/creating-components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating Components
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Frontend
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Frontend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/classic/frontend/README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Readme
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/LICENSE" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Significant-Gravitas/AutoGPT/edit/master/docs/content/platform/new_blocks.backup.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Significant-Gravitas/AutoGPT/raw/master/docs/content/platform/new_blocks.backup.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg>
    </a>
  


<h1 id="contributing-to-autogpt-agent-server-creating-and-testing-blocks">Contributing to AutoGPT Agent Server: Creating and Testing Blocks<a class="headerlink" href="#contributing-to-autogpt-agent-server-creating-and-testing-blocks" title="Permanent link">&para;</a></h1>
<p>This guide will walk you through the process of creating and testing a new block for the AutoGPT Agent Server, using the WikipediaSummaryBlock as an example.</p>
<h2 id="understanding-blocks-and-testing">Understanding Blocks and Testing<a class="headerlink" href="#understanding-blocks-and-testing" title="Permanent link">&para;</a></h2>
<p>Blocks are reusable components that can be connected to form a graph representing an agent's behavior. Each block has inputs, outputs, and a specific function. Proper testing is crucial to ensure blocks work correctly and consistently.</p>
<h2 id="creating-and-testing-a-new-block">Creating and Testing a New Block<a class="headerlink" href="#creating-and-testing-a-new-block" title="Permanent link">&para;</a></h2>
<p>Follow these steps to create and test a new block:</p>
<ol>
<li>
<p><strong>Create a new Python file</strong> for your block in the <code>autogpt_platform/backend/backend/blocks</code> directory. Name it descriptively and use snake_case. For example: <code>get_wikipedia_summary.py</code>.</p>
</li>
<li>
<p><strong>Import necessary modules and create a class that inherits from <code>Block</code></strong>. Make sure to include all necessary imports for your block.</p>
<p>Every block should contain the following:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">backend.data.block</span> <span class="kn">import</span> <span class="n">Block</span><span class="p">,</span> <span class="n">BlockSchema</span><span class="p">,</span> <span class="n">BlockOutput</span>
</code></pre></div>
<p>Example for the Wikipedia summary block:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">backend.data.block</span> <span class="kn">import</span> <span class="n">Block</span><span class="p">,</span> <span class="n">BlockSchema</span><span class="p">,</span> <span class="n">BlockOutput</span>
<span class="kn">from</span> <span class="nn">backend.utils.get_request</span> <span class="kn">import</span> <span class="n">GetRequest</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">class</span> <span class="nc">WikipediaSummaryBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">,</span> <span class="n">GetRequest</span><span class="p">):</span>
    <span class="c1"># Block implementation will go here</span>
</code></pre></div>
</li>
<li>
<p><strong>Define the input and output schemas</strong> using <code>BlockSchema</code>. These schemas specify the data structure that the block expects to receive (input) and produce (output).</p>
</li>
<li>
<p>The input schema defines the structure of the data the block will process. Each field in the schema represents a required piece of input data.</p>
</li>
<li>
<p>The output schema defines the structure of the data the block will return after processing. Each field in the schema represents a piece of output data.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
    <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The topic to get the Wikipedia summary for</span>

<span class="k">class</span> <span class="nc">Output</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The summary of the topic from Wikipedia</span>
    <span class="n">error</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Any error message if the request fails, error field needs to be named `error`.</span>
</code></pre></div>
</li>
<li>
<p><strong>Implement the <code>__init__</code> method, including test data and mocks:</strong></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Use UUID generator (e.g. https://www.uuidgenerator.net/) for every new block <code>id</code> and <em>do not</em> make up your own. Alternatively, you can run this python code to generate an uuid: <code>print(__import__('uuid').uuid4())</code></p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="c1"># Unique ID for the block, used across users for templates</span>
        <span class="c1"># If you are an AI leave it as is or change to &quot;generate-proper-uuid&quot;</span>
        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;</span><span class="p">,</span>
        <span class="n">input_schema</span><span class="o">=</span><span class="n">WikipediaSummaryBlock</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span>  <span class="c1"># Assign input schema</span>
        <span class="n">output_schema</span><span class="o">=</span><span class="n">WikipediaSummaryBlock</span><span class="o">.</span><span class="n">Output</span><span class="p">,</span>  <span class="c1"># Assign output schema</span>

            <span class="c1"># Provide sample input, output and test mock for testing the block</span>

        <span class="n">test_input</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;Artificial Intelligence&quot;</span><span class="p">},</span>
        <span class="n">test_output</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="s2">&quot;summary content&quot;</span><span class="p">),</span>
        <span class="n">test_mock</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;get_request&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;extract&quot;</span><span class="p">:</span> <span class="s2">&quot;summary content&quot;</span><span class="p">}},</span>
    <span class="p">)</span>
</code></pre></div>
<ul>
<li>
<p><code>id</code>: A unique identifier for the block.</p>
</li>
<li>
<p><code>input_schema</code> and <code>output_schema</code>: Define the structure of the input and output data.</p>
</li>
</ul>
<p>Let's break down the testing components:</p>
<ul>
<li>
<p><code>test_input</code>: This is a sample input that will be used to test the block. It should be a valid input according to your Input schema.</p>
</li>
<li>
<p><code>test_output</code>: This is the expected output when running the block with the <code>test_input</code>. It should match your Output schema. For non-deterministic outputs or when you only want to assert the type, you can use Python types instead of specific values. In this example, <code>("summary", str)</code> asserts that the output key is "summary" and its value is a string.</p>
</li>
<li>
<p><code>test_mock</code>: This is crucial for blocks that make network calls. It provides a mock function that replaces the actual network call during testing.</p>
</li>
</ul>
<p>In this case, we're mocking the <code>get_request</code> method to always return a dictionary with an 'extract' key, simulating a successful API response. This allows us to test the block's logic without making actual network requests, which could be slow, unreliable, or rate-limited.</p>
</li>
<li>
<p><strong>Implement the <code>run</code> method with error handling.</strong> This should contain the main logic of the block:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">topic</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://en.wikipedia.org/api/rest_v1/page/summary/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;extract&#39;</span><span class="p">]</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTP error occurred: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><strong>Try block</strong>: Contains the main logic to fetch and process the Wikipedia summary.</li>
<li><strong>API request</strong>: Send a GET request to the Wikipedia API.</li>
<li><strong>Error handling</strong>: Handle various exceptions that might occur during the API request and data processing. We don't need to catch all exceptions, only the ones we expect and can handle. The uncaught exceptions will be automatically yielded as <code>error</code> in the output. Any block that raises an exception (or yields an <code>error</code> output) will be marked as failed. Prefer raising exceptions over yielding <code>error</code>, as it will stop the execution immediately.</li>
<li><strong>Yield</strong>: Use <code>yield</code> to output the results. Prefer to output one result object at a time. If you are calling a function that returns a list, you can yield each item in the list separately. You can also yield the whole list as well, but do both rather than yielding the list. For example: If you were writing a block that outputs emails, you'd yield each email as a separate result object, but you could also yield the whole list as an additional single result object. Yielding output named <code>error</code> will break the execution right away and mark the block execution as failed.</li>
<li><strong>kwargs</strong>: The <code>kwargs</code> parameter is used to pass additional arguments to the block. It is not used in the example above, but it is available to the block. You can also have args as inline signatures in the run method ala <code>def run(self, input_data: Input, *, user_id: str, **kwargs) -&gt; BlockOutput:</code>.
       Available kwargs are:<ul>
<li><code>user_id</code>: The ID of the user running the block.</li>
<li><code>graph_id</code>: The ID of the agent that is executing the block. This is the same for every version of the agent</li>
<li><code>graph_exec_id</code>: The ID of the execution of the agent. This changes every time the agent has a new "run"</li>
<li><code>node_exec_id</code>: The ID of the execution of the node. This changes every time the node is executed</li>
<li><code>node_id</code>: The ID of the node that is being executed. It changes every version of the graph, but not every time the node is executed.</li>
</ul>
</li>
</ul>
<h3 id="field-types">Field Types<a class="headerlink" href="#field-types" title="Permanent link">&para;</a></h3>
<h4 id="oneof-fields">oneOf fields<a class="headerlink" href="#oneof-fields" title="Permanent link">&para;</a></h4>
<p><code>oneOf</code> allows you to specify that a field must be exactly one of several possible options. This is useful when you want your block to accept different types of inputs that are mutually exclusive.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">attachment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Media</span><span class="p">,</span> <span class="n">DeepLink</span><span class="p">,</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Place</span><span class="p">,</span> <span class="n">Quote</span><span class="p">]</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
    <span class="n">discriminator</span><span class="o">=</span><span class="s1">&#39;discriminator&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Attach either media, deep link, poll, place or quote - only one can be used&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<p>The <code>discriminator</code> parameter tells AutoGPT which field to look at in the input to determine which type it is.</p>
<p>In each model, you need to define the discriminator value:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Media</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">discriminator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;media&#39;</span><span class="p">]</span>
    <span class="n">media_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">DeepLink</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">discriminator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;deep_link&#39;</span><span class="p">]</span>
    <span class="n">direct_message_deep_link</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></p>
<h4 id="optionaloneof-fields">OptionalOneOf fields<a class="headerlink" href="#optionaloneof-fields" title="Permanent link">&para;</a></h4>
<p><code>OptionalOneOf</code> is similar to <code>oneOf</code> but allows the field to be optional (None). This means the field can be either one of the specified types or None.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">attachment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Media</span><span class="p">,</span> <span class="n">DeepLink</span><span class="p">,</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Place</span><span class="p">,</span> <span class="n">Quote</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
    <span class="n">discriminator</span><span class="o">=</span><span class="s1">&#39;discriminator&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Optional attachment - can be media, deep link, poll, place, quote or None&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<p>The key difference is the <code>| None</code> which makes the entire field optional.</p>
<h3 id="blocks-with-authentication">Blocks with authentication<a class="headerlink" href="#blocks-with-authentication" title="Permanent link">&para;</a></h3>
<p>Our system supports auth offloading for API keys and OAuth2 authorization flows.
Adding a block with API key authentication is straight-forward, as is adding a block
for a service that we already have OAuth2 support for.</p>
<p>Implementing the block itself is relatively simple. On top of the instructions above,
you're going to add a <code>credentials</code> parameter to the <code>Input</code> model and the <code>run</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">backend.data.model</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">APIKeyCredentials</span><span class="p">,</span>
    <span class="n">OAuth2Credentials</span><span class="p">,</span>
    <span class="n">Credentials</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">backend.data.block</span> <span class="kn">import</span> <span class="n">Block</span><span class="p">,</span> <span class="n">BlockOutput</span><span class="p">,</span> <span class="n">BlockSchema</span>
<span class="kn">from</span> <span class="nn">backend.data.model</span> <span class="kn">import</span> <span class="n">CredentialsField</span>
<span class="kn">from</span> <span class="nn">backend.integrations.providers</span> <span class="kn">import</span> <span class="n">ProviderName</span>


<span class="c1"># API Key auth:</span>
<span class="k">class</span> <span class="nc">BlockWithAPIKeyAuth</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="c1"># Note that the type hint below is require or you will get a type error.</span>
        <span class="c1"># The first argument is the provider name, the second is the credential type.</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">CredentialsMetaInput</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="n">ProviderName</span><span class="o">.</span><span class="n">GITHUB</span><span class="p">],</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">CredentialsField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The GitHub integration can be used with &quot;</span>
            <span class="s2">&quot;any API key with sufficient permissions for the blocks it is used on.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">APIKeyCredentials</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
        <span class="o">...</span>

<span class="c1"># OAuth:</span>
<span class="k">class</span> <span class="nc">BlockWithOAuth</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="c1"># Note that the type hint below is require or you will get a type error.</span>
        <span class="c1"># The first argument is the provider name, the second is the credential type.</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">CredentialsMetaInput</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="n">ProviderName</span><span class="o">.</span><span class="n">GITHUB</span><span class="p">],</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;oauth2&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">CredentialsField</span><span class="p">(</span>
            <span class="n">required_scopes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;repo&quot;</span><span class="p">},</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The GitHub integration can be used with OAuth.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">OAuth2Credentials</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
        <span class="o">...</span>

<span class="c1"># API Key auth + OAuth:</span>
<span class="k">class</span> <span class="nc">BlockWithAPIKeyAndOAuth</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="c1"># Note that the type hint below is require or you will get a type error.</span>
        <span class="c1"># The first argument is the provider name, the second is the credential type.</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">CredentialsMetaInput</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="n">ProviderName</span><span class="o">.</span><span class="n">GITHUB</span><span class="p">],</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">CredentialsField</span><span class="p">(</span>
            <span class="n">required_scopes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;repo&quot;</span><span class="p">},</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The GitHub integration can be used with OAuth, &quot;</span>
            <span class="s2">&quot;or any API key with sufficient permissions for the blocks it is used on.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
        <span class="o">...</span>
</code></pre></div>
<p>The credentials will be automagically injected by the executor in the back end.</p>
<p>The <code>APIKeyCredentials</code> and <code>OAuth2Credentials</code> models are defined <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/autogpt_libs/autogpt_libs/supabase_integration_credentials_store/types.py">here</a>.
To use them in e.g. an API request, you can either access the token directly:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># credentials: APIKeyCredentials</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="n">url</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">credentials</span><span class="o">.</span><span class="n">api_key</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># credentials: OAuth2Credentials</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="n">url</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div>
<p>or use the shortcut <code>credentials.auth_header()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># credentials: APIKeyCredentials | OAuth2Credentials</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="n">url</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">auth_header</span><span class="p">()},</span>
<span class="p">)</span>
</code></pre></div>
<p>The <code>ProviderName</code> enum is the single source of truth for which providers exist in our system.
Naturally, to add an authenticated block for a new provider, you'll have to add it here too.</p>
<details>
<summary><code>ProviderName</code> definition</summary>

<div class="highlight"><span class="filename">backend/integrations/providers.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">ProviderName</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">ANTHROPIC</span> <span class="o">=</span> <span class="s2">&quot;anthropic&quot;</span>
    <span class="n">APOLLO</span> <span class="o">=</span> <span class="s2">&quot;apollo&quot;</span>
    <span class="n">COMPASS</span> <span class="o">=</span> <span class="s2">&quot;compass&quot;</span>
    <span class="n">DISCORD</span> <span class="o">=</span> <span class="s2">&quot;discord&quot;</span>
    <span class="n">D_ID</span> <span class="o">=</span> <span class="s2">&quot;d_id&quot;</span>
    <span class="n">E2B</span> <span class="o">=</span> <span class="s2">&quot;e2b&quot;</span>
    <span class="n">EXA</span> <span class="o">=</span> <span class="s2">&quot;exa&quot;</span>
    <span class="n">FAL</span> <span class="o">=</span> <span class="s2">&quot;fal&quot;</span>
    <span class="n">GITHUB</span> <span class="o">=</span> <span class="s2">&quot;github&quot;</span>
    <span class="n">GOOGLE</span> <span class="o">=</span> <span class="s2">&quot;google&quot;</span>
    <span class="n">GOOGLE_MAPS</span> <span class="o">=</span> <span class="s2">&quot;google_maps&quot;</span>
    <span class="n">GROQ</span> <span class="o">=</span> <span class="s2">&quot;groq&quot;</span>
    <span class="n">HUBSPOT</span> <span class="o">=</span> <span class="s2">&quot;hubspot&quot;</span>
    <span class="n">IDEOGRAM</span> <span class="o">=</span> <span class="s2">&quot;ideogram&quot;</span>
    <span class="n">JINA</span> <span class="o">=</span> <span class="s2">&quot;jina&quot;</span>
    <span class="n">LINEAR</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
    <span class="n">MEDIUM</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
    <span class="n">MEM0</span> <span class="o">=</span> <span class="s2">&quot;mem0&quot;</span>
    <span class="n">NOTION</span> <span class="o">=</span> <span class="s2">&quot;notion&quot;</span>
    <span class="n">NVIDIA</span> <span class="o">=</span> <span class="s2">&quot;nvidia&quot;</span>
    <span class="n">OLLAMA</span> <span class="o">=</span> <span class="s2">&quot;ollama&quot;</span>
    <span class="n">OPENAI</span> <span class="o">=</span> <span class="s2">&quot;openai&quot;</span>
    <span class="n">OPENWEATHERMAP</span> <span class="o">=</span> <span class="s2">&quot;openweathermap&quot;</span>
    <span class="n">OPEN_ROUTER</span> <span class="o">=</span> <span class="s2">&quot;open_router&quot;</span>
    <span class="n">PINECONE</span> <span class="o">=</span> <span class="s2">&quot;pinecone&quot;</span>
    <span class="n">REDDIT</span> <span class="o">=</span> <span class="s2">&quot;reddit&quot;</span>
    <span class="n">REPLICATE</span> <span class="o">=</span> <span class="s2">&quot;replicate&quot;</span>
    <span class="n">REVID</span> <span class="o">=</span> <span class="s2">&quot;revid&quot;</span>
    <span class="n">SCREENSHOTONE</span> <span class="o">=</span> <span class="s2">&quot;screenshotone&quot;</span>
    <span class="n">SLANT3D</span> <span class="o">=</span> <span class="s2">&quot;slant3d&quot;</span>
    <span class="n">SMARTLEAD</span> <span class="o">=</span> <span class="s2">&quot;smartlead&quot;</span>
    <span class="n">SMTP</span> <span class="o">=</span> <span class="s2">&quot;smtp&quot;</span>
    <span class="n">TWITTER</span> <span class="o">=</span> <span class="s2">&quot;twitter&quot;</span>
    <span class="n">TODOIST</span> <span class="o">=</span> <span class="s2">&quot;todoist&quot;</span>
    <span class="n">UNREAL_SPEECH</span> <span class="o">=</span> <span class="s2">&quot;unreal_speech&quot;</span>
    <span class="n">ZEROBOUNCE</span> <span class="o">=</span> <span class="s2">&quot;zerobounce&quot;</span>
</code></pre></div>
</details>

<h4 id="multiple-credentials-inputs">Multiple credentials inputs<a class="headerlink" href="#multiple-credentials-inputs" title="Permanent link">&para;</a></h4>
<p>Multiple credentials inputs are supported, under the following conditions:
- The name of each of the credentials input fields must end with <code>_credentials</code>.
- The names of the credentials input fields must match the names of the corresponding
  parameters on the <code>run(..)</code> method of the block.
- If more than one of the credentials parameters are required, <code>test_credentials</code>
  is a <code>dict[str, Credentials]</code>, with for each required credentials input the
  parameter name as the key and suitable test credentials as the value.</p>
<h4 id="adding-an-oauth2-service-integration">Adding an OAuth2 service integration<a class="headerlink" href="#adding-an-oauth2-service-integration" title="Permanent link">&para;</a></h4>
<p>To add support for a new OAuth2-authenticated service, you'll need to add an <code>OAuthHandler</code>.
All our existing handlers and the base class can be found <a href="https://github.com/Significant-Gravitas/AutoGPT/tree/master/autogpt_platform/backend/backend/integrations/oauth">here</a>.</p>
<p>Every handler must implement the following parts of the [<code>BaseOAuthHandler</code>] interface:</p>
<div class="highlight"><span class="filename">backend/integrations/oauth/base.py</span><pre><span></span><code><span class="n">PROVIDER_NAME</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">ProviderName</span><span class="p">]</span>
<span class="n">DEFAULT_SCOPES</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">get_login_url</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_challenge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">exchange_code_for_tokens</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">code_verifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OAuth2Credentials</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">_refresh_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">OAuth2Credentials</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OAuth2Credentials</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">revoke_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">OAuth2Credentials</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</code></pre></div>
<p>As you can see, this is modeled after the standard OAuth2 flow.</p>
<p>Aside from implementing the <code>OAuthHandler</code> itself, adding a handler into the system requires two more things:</p>
<ul>
<li>Adding the handler class to <code>HANDLERS_BY_NAME</code> under <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/backend/backend/integrations/oauth/__init__.py"><code>integrations/oauth/__init__.py</code></a></li>
</ul>
<div class="highlight"><span class="filename">backend/integrations/oauth/__init__.py</span><pre><span></span><code><span class="n">HANDLERS_BY_NAME</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="s2">&quot;ProviderName&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;BaseOAuthHandler&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">PROVIDER_NAME</span><span class="p">:</span> <span class="n">handler</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">GitHubOAuthHandler</span><span class="p">,</span>
        <span class="n">GoogleOAuthHandler</span><span class="p">,</span>
        <span class="n">NotionOAuthHandler</span><span class="p">,</span>
        <span class="n">TwitterOAuthHandler</span><span class="p">,</span>
        <span class="n">LinearOAuthHandler</span><span class="p">,</span>
        <span class="n">TodoistOAuthHandler</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Adding <code>{provider}_client_id</code> and <code>{provider}_client_secret</code> to the application's <code>Secrets</code> under <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/backend/backend/util/settings.py"><code>util/settings.py</code></a></li>
</ul>
<div class="highlight"><span class="filename">backend/util/settings.py</span><pre><span></span><code><span class="n">github_client_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;GitHub OAuth client ID&quot;</span><span class="p">)</span>
<span class="n">github_client_secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;GitHub OAuth client secret&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="adding-to-the-frontend">Adding to the frontend<a class="headerlink" href="#adding-to-the-frontend" title="Permanent link">&para;</a></h4>
<p>You will need to add the provider (api or oauth) to the <code>CredentialsInput</code> component in <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/frontend/src/components/integrations/credentials-input.tsx"><code>frontend/src/components/integrations/credentials-input.tsx</code></a>.</p>
<div class="highlight"><span class="filename">frontend/src/components/integrations/credentials-input.tsx</span><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">providerIcons</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span>
<span class="w">  </span><span class="nx">CredentialsProviderName</span><span class="p">,</span>
<span class="w">  </span><span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">className?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span>
<span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">anthropic</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">apollo</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">e2b</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">github</span><span class="o">:</span><span class="w"> </span><span class="kt">FaGithub</span><span class="p">,</span>
<span class="w">  </span><span class="nx">google</span><span class="o">:</span><span class="w"> </span><span class="kt">FaGoogle</span><span class="p">,</span>
<span class="w">  </span><span class="nx">groq</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">notion</span><span class="o">:</span><span class="w"> </span><span class="kt">NotionLogoIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">nvidia</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">discord</span><span class="o">:</span><span class="w"> </span><span class="kt">FaDiscord</span><span class="p">,</span>
<span class="w">  </span><span class="nx">d_id</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">google_maps</span><span class="o">:</span><span class="w"> </span><span class="kt">FaGoogle</span><span class="p">,</span>
<span class="w">  </span><span class="nx">jina</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ideogram</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">linear</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">medium</span><span class="o">:</span><span class="w"> </span><span class="kt">FaMedium</span><span class="p">,</span>
<span class="w">  </span><span class="nx">mem0</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ollama</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">openai</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">openweathermap</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">open_router</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">pinecone</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">slant3d</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">screenshotone</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">smtp</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">replicate</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reddit</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fal</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">revid</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="kt">FaTwitter</span><span class="p">,</span>
<span class="w">  </span><span class="nx">unreal_speech</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">exa</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">hubspot</span><span class="o">:</span><span class="w"> </span><span class="kt">FaHubspot</span><span class="p">,</span>
<span class="w">  </span><span class="nx">smartlead</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">todoist</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="w">  </span><span class="nx">zerobounce</span><span class="o">:</span><span class="w"> </span><span class="kt">fallbackIcon</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
<p>You will also need to add the provider to the <code>CredentialsProvider</code> component in <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/frontend/src/components/integrations/credentials-provider.tsx"><code>frontend/src/components/integrations/credentials-provider.tsx</code></a>.</p>
<div class="highlight"><span class="filename">frontend/src/components/integrations/credentials-provider.tsx</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">providerDisplayNames</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="nx">CredentialsProviderName</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">anthropic</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Anthropic&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">apollo</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Apollo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">discord</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Discord&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">d_id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;D-ID&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">e2b</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;E2B&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">exa</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Exa&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fal</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;FAL&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">github</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;GitHub&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">google</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Google&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">google_maps</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Google Maps&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">groq</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Groq&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">hubspot</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hubspot&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ideogram</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Ideogram&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">jina</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Jina&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">linear</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Linear&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">medium</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Medium&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">mem0</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Mem0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">notion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Notion&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">nvidia</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Nvidia&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ollama</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Ollama&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">openai</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;OpenAI&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">openweathermap</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">open_router</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Open Router&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">pinecone</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Pinecone&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">screenshotone</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ScreenshotOne&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">slant3d</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Slant3D&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">smartlead</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SmartLead&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">smtp</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SMTP&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">reddit</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Reddit&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">replicate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Replicate&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">revid</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Rev.ID&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Twitter&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">todoist</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Todoist&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">unreal_speech</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Unreal Speech&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">zerobounce</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ZeroBounce&quot;</span><span class="p">,</span>
<span class="p">}</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">;</span>
</code></pre></div>
<p>Finally you will need to add the provider to the <code>CredentialsType</code> enum in <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/frontend/src/lib/autogpt-server-api/types.ts"><code>frontend/src/lib/autogpt-server-api/types.ts</code></a>.</p>
<div class="highlight"><span class="filename">frontend/src/lib/autogpt-server-api/types.ts</span><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">PROVIDER_NAMES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ANTHROPIC</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;anthropic&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">APOLLO</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;apollo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">D_ID</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;d_id&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">DISCORD</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;discord&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">E2B</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;e2b&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">EXA</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;exa&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">FAL</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;fal&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">GITHUB</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;github&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">GOOGLE</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;google&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">GOOGLE_MAPS</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;google_maps&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">GROQ</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;groq&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">HUBSPOT</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hubspot&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">IDEOGRAM</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ideogram&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">JINA</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;jina&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">LINEAR</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">MEDIUM</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">MEM0</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">NOTION</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;notion&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">NVIDIA</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;nvidia&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">OLLAMA</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ollama&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">OPENAI</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">OPENWEATHERMAP</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;openweathermap&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">OPEN_ROUTER</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;open_router&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">PINECONE</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;pinecone&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">SCREENSHOTONE</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;screenshotone&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">SLANT3D</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;slant3d&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">SMARTLEAD</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;smartlead&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">SMTP</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;smtp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">TWITTER</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;twitter&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">REPLICATE</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;replicate&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">REDDIT</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;reddit&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">REVID</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;revid&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">UNREAL_SPEECH</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;unreal_speech&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">TODOIST</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;todoist&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ZEROBOUNCE</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;zerobounce&quot;</span><span class="p">,</span>
<span class="p">}</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">;</span>
</code></pre></div>
<h4 id="example-github-integration">Example: GitHub integration<a class="headerlink" href="#example-github-integration" title="Permanent link">&para;</a></h4>
<ul>
<li>GitHub blocks with API key + OAuth2 support: <a href="https://github.com/Significant-Gravitas/AutoGPT/tree/master/autogpt_platform/backend/backend/blocks/github/"><code>blocks/github</code></a></li>
</ul>
<div class="highlight"><span class="filename">backend/blocks/github/issues.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">GithubCommentBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">GithubCredentialsInput</span> <span class="o">=</span> <span class="n">GithubCredentialsField</span><span class="p">(</span><span class="s2">&quot;repo&quot;</span><span class="p">)</span>
        <span class="n">issue_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;URL of the GitHub issue or pull request&quot;</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;https://github.com/owner/repo/issues/1&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Comment to post on the issue or pull request&quot;</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Enter your comment&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Output</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of the created comment&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;URL to the comment on GitHub&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Error message if the comment posting failed&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;a8db4d8d-db1c-4a25-a1b0-416a8c33602b&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;This block posts a comment on a specified GitHub issue or pull request.&quot;</span><span class="p">,</span>
            <span class="n">categories</span><span class="o">=</span><span class="p">{</span><span class="n">BlockCategory</span><span class="o">.</span><span class="n">DEVELOPER_TOOLS</span><span class="p">},</span>
            <span class="n">input_schema</span><span class="o">=</span><span class="n">GithubCommentBlock</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span>
            <span class="n">output_schema</span><span class="o">=</span><span class="n">GithubCommentBlock</span><span class="o">.</span><span class="n">Output</span><span class="p">,</span>
            <span class="n">test_input</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;issue_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/owner/repo/issues/1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a test comment.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;credentials&quot;</span><span class="p">:</span> <span class="n">TEST_CREDENTIALS_INPUT</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;issue_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/owner/repo/pull/1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a test comment.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;credentials&quot;</span><span class="p">:</span> <span class="n">TEST_CREDENTIALS_INPUT</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">test_credentials</span><span class="o">=</span><span class="n">TEST_CREDENTIALS</span><span class="p">,</span>
            <span class="n">test_output</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;https://github.com/owner/repo/issues/1#issuecomment-1337&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">),</span>
                <span class="p">(</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;https://github.com/owner/repo/issues/1#issuecomment-1337&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">test_mock</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;post_comment&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="p">(</span>
                    <span class="mi">1337</span><span class="p">,</span>
                    <span class="s2">&quot;https://github.com/owner/repo/issues/1#issuecomment-1337&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">post_comment</span><span class="p">(</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">GithubCredentials</span><span class="p">,</span> <span class="n">issue_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">body_text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">get_api</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">body_text</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;pull&quot;</span> <span class="ow">in</span> <span class="n">issue_url</span><span class="p">:</span>
            <span class="n">issue_url</span> <span class="o">=</span> <span class="n">issue_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;pull&quot;</span><span class="p">,</span> <span class="s2">&quot;issues&quot;</span><span class="p">)</span>
        <span class="n">comments_url</span> <span class="o">=</span> <span class="n">issue_url</span> <span class="o">+</span> <span class="s2">&quot;/comments&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">comments_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&quot;html_url&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">GithubCredentials</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
        <span class="nb">id</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_comment</span><span class="p">(</span>
            <span class="n">credentials</span><span class="p">,</span>
            <span class="n">input_data</span><span class="o">.</span><span class="n">issue_url</span><span class="p">,</span>
            <span class="n">input_data</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">id</span>
        <span class="k">yield</span> <span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url</span>
</code></pre></div>
<ul>
<li>GitHub OAuth2 handler: <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/backend/backend/integrations/oauth/github.py"><code>integrations/oauth/github.py</code></a></li>
</ul>
<div class="highlight"><span class="filename">backend/integrations/oauth/github.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">GitHubOAuthHandler</span><span class="p">(</span><span class="n">BaseOAuthHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Based on the documentation at:</span>
<span class="sd">    - [Authorizing OAuth apps - GitHub Docs](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps)</span>
<span class="sd">    - [Refreshing user access tokens - GitHub Docs](https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/refreshing-user-access-tokens)</span>

<span class="sd">    Notes:</span>
<span class="sd">    - By default, token expiration is disabled on GitHub Apps. This means the access</span>
<span class="sd">      token doesn&#39;t expire and no refresh token is returned by the authorization flow.</span>
<span class="sd">    - When token expiration gets enabled, any existing tokens will remain non-expiring.</span>
<span class="sd">    - When token expiration gets disabled, token refreshes will return a non-expiring</span>
<span class="sd">      access token *with no refresh token*.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="n">PROVIDER_NAME</span> <span class="o">=</span> <span class="n">ProviderName</span><span class="o">.</span><span class="n">GITHUB</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">=</span> <span class="n">redirect_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_base_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/login/oauth/authorize&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/login/oauth/access_token&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revoke_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.github.com/applications/</span><span class="si">{client_id}</span><span class="s2">/token&quot;</span>

    <span class="k">def</span> <span class="nf">get_login_url</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_challenge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
            <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scopes</span><span class="p">),</span>
            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_base_url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">exchange_code_for_tokens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">code_verifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OAuth2Credentials</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_tokens</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">revoke_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">OAuth2Credentials</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No access token to revoke&quot;</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github+json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;X-GitHub-Api-Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-11-28&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">revoke_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">),</span>
            <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">access_token</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_refresh_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">OAuth2Credentials</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OAuth2Credentials</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">credentials</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_tokens</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">(),</span>
                <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_request_tokens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">current_credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OAuth2Credentials</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OAuth2Credentials</span><span class="p">:</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="o">**</span><span class="n">params</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_body</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">token_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_username</span><span class="p">(</span><span class="n">token_data</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">])</span>

        <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">new_credentials</span> <span class="o">=</span> <span class="n">OAuth2Credentials</span><span class="p">(</span>
            <span class="n">provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_NAME</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">current_credentials</span><span class="o">.</span><span class="n">title</span> <span class="k">if</span> <span class="n">current_credentials</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">access_token</span><span class="o">=</span><span class="n">token_data</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span>
            <span class="c1"># Token refresh responses have an empty `scope` property (see docs),</span>
            <span class="c1"># so we have to get the scope from the existing credentials object.</span>
            <span class="n">scopes</span><span class="o">=</span><span class="p">(</span>
                <span class="n">token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">current_credentials</span><span class="o">.</span><span class="n">scopes</span> <span class="k">if</span> <span class="n">current_credentials</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="p">),</span>
            <span class="c1"># Refresh token and expiration intervals are only given if token expiration</span>
            <span class="c1"># is enabled in the GitHub App&#39;s settings.</span>
            <span class="n">refresh_token</span><span class="o">=</span><span class="n">token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">),</span>
            <span class="n">access_token_expires_at</span><span class="o">=</span><span class="p">(</span>
                <span class="n">now</span> <span class="o">+</span> <span class="n">expires_in</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">expires_in</span> <span class="o">:=</span> <span class="n">token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;expires_in&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">refresh_token_expires_at</span><span class="o">=</span><span class="p">(</span>
                <span class="n">now</span> <span class="o">+</span> <span class="n">expires_in</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">expires_in</span> <span class="o">:=</span> <span class="n">token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;refresh_token_expires_in&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">current_credentials</span><span class="p">:</span>
            <span class="n">new_credentials</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">current_credentials</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="n">new_credentials</span>

    <span class="k">def</span> <span class="nf">_request_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.github.com/user&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github+json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;X-GitHub-Api-Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-11-28&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get the login (username)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="example-google-integration">Example: Google integration<a class="headerlink" href="#example-google-integration" title="Permanent link">&para;</a></h4>
<ul>
<li>Google OAuth2 handler: <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/backend/backend/integrations/oauth/google.py"><code>integrations/oauth/google.py</code></a></li>
</ul>
<div class="highlight"><span class="filename">backend/integrations/oauth/google.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">GoogleOAuthHandler</span><span class="p">(</span><span class="n">BaseOAuthHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Based on the documentation at https://developers.google.com/identity/protocols/oauth2/web-server</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="n">PROVIDER_NAME</span> <span class="o">=</span> <span class="n">ProviderName</span><span class="o">.</span><span class="n">GOOGLE</span>
    <span class="n">EMAIL_ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;https://www.googleapis.com/oauth2/v2/userinfo&quot;</span>
    <span class="n">DEFAULT_SCOPES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;https://www.googleapis.com/auth/userinfo.email&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://www.googleapis.com/auth/userinfo.profile&quot;</span><span class="p">,</span>
        <span class="s2">&quot;openid&quot;</span><span class="p">,</span>
    <span class="p">]</span>
</code></pre></div>
<p>You can see that google has defined a <code>DEFAULT_SCOPES</code> variable, this is used to set the scopes that are requested no matter what the user asks for.</p>
<div class="highlight"><span class="filename">backend/blocks/google/_auth.py</span><pre><span></span><code><span class="n">secrets</span> <span class="o">=</span> <span class="n">Secrets</span><span class="p">()</span>
<span class="n">GOOGLE_OAUTH_IS_CONFIGURED</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
    <span class="n">secrets</span><span class="o">.</span><span class="n">google_client_id</span> <span class="ow">and</span> <span class="n">secrets</span><span class="o">.</span><span class="n">google_client_secret</span>
<span class="p">)</span>
</code></pre></div>
<p>You can also see that <code>GOOGLE_OAUTH_IS_CONFIGURED</code> is used to disable the blocks that require OAuth if the oauth is not configured. This is in the <code>__init__</code> method of each block. This is because there is no api key fallback for google blocks so we need to make sure that the oauth is configured before we allow the user to use the blocks.</p>
<h3 id="webhook-triggered-blocks">Webhook-triggered Blocks<a class="headerlink" href="#webhook-triggered-blocks" title="Permanent link">&para;</a></h3>
<p>Webhook-triggered blocks allow your agent to respond to external events in real-time.
These blocks are triggered by incoming webhooks from third-party services
rather than being executed manually.</p>
<p>Creating and running a webhook-triggered block involves three main components:</p>
<ul>
<li>The block itself, which specifies:<ul>
<li>Inputs for the user to select a resource and events to subscribe to</li>
<li>A <code>credentials</code> input with the scopes needed to manage webhooks</li>
<li>Logic to turn the webhook payload into outputs for the webhook block</li>
</ul>
</li>
<li>The <code>WebhooksManager</code> for the corresponding webhook service provider, which handles:<ul>
<li>(De)registering webhooks with the provider</li>
<li>Parsing and validating incoming webhook payloads</li>
</ul>
</li>
<li>The credentials system for the corresponding service provider, which may include an <code>OAuthHandler</code></li>
</ul>
<p>There is more going on under the hood, e.g. to store and retrieve webhooks and their
links to nodes, but to add a webhook-triggered block you shouldn't need to make changes
to those parts of the system.</p>
<h4 id="creating-a-webhook-triggered-block">Creating a Webhook-triggered Block<a class="headerlink" href="#creating-a-webhook-triggered-block" title="Permanent link">&para;</a></h4>
<p>To create a webhook-triggered block, follow these additional steps on top of the basic block creation process:</p>
<ol>
<li>
<p><strong>Define <code>webhook_config</code></strong> in your block's <code>__init__</code> method.</p>
<p><details>
<summary>Example: <code>GitHubPullRequestTriggerBlock</code></summary></p>
<p><div class="highlight"><span class="filename">backend/blocks/github/triggers.py</span><pre><span></span><code><span class="n">webhook_config</span><span class="o">=</span><span class="n">BlockWebhookConfig</span><span class="p">(</span>
    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;github&quot;</span><span class="p">,</span>
    <span class="n">webhook_type</span><span class="o">=</span><span class="n">GithubWebhookType</span><span class="o">.</span><span class="n">REPO</span><span class="p">,</span>
    <span class="n">resource_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{repo}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">event_filter_input</span><span class="o">=</span><span class="s2">&quot;events&quot;</span><span class="p">,</span>
    <span class="n">event_format</span><span class="o">=</span><span class="s2">&quot;pull_request.</span><span class="si">{event}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">),</span>
</code></pre></div>
</details></p>
<p><details>
<summary><code>BlockWebhookConfig</code> definition</summary></p>
<p><div class="highlight"><span class="filename">backend/data/block.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">BlockManualWebhookConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration model for webhook-triggered blocks on which</span>
<span class="sd">    the user has to manually set up the webhook at the provider.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The service provider that the webhook connects to&quot;&quot;&quot;</span>

    <span class="n">webhook_type</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identifier for the webhook type. E.g. GitHub has repo and organization level hooks.</span>

<span class="sd">    Only for use in the corresponding `WebhooksManager`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">event_filter_input</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Name of the block&#39;s event filter input.</span>
<span class="sd">    Leave empty if the corresponding webhook doesn&#39;t have distinct event/payload types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">event_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{event}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Template string for the event(s) that a block instance subscribes to.</span>
<span class="sd">    Applied individually to each event selected in the event filter input.</span>

<span class="sd">    Example: `&quot;pull_request.{event}&quot;` -&gt; `&quot;pull_request.opened&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">BlockWebhookConfig</span><span class="p">(</span><span class="n">BlockManualWebhookConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration model for webhook-triggered blocks for which</span>
<span class="sd">    the webhook can be automatically set up through the provider&#39;s API.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">resource_format</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Template string for the resource that a block instance subscribes to.</span>
<span class="sd">    Fields will be filled from the block&#39;s inputs (except `payload`).</span>

<span class="sd">    Example: `f&quot;{repo}/pull_requests&quot;` (note: not how it&#39;s actually implemented)</span>

<span class="sd">    Only for use in the corresponding `WebhooksManager`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</details></p>
</li>
<li>
<p><strong>Define event filter input</strong> in your block's Input schema.
    This allows the user to select which specific types of events will trigger the block in their agent.</p>
<p><details>
<summary>Example: <code>GitHubPullRequestTriggerBlock</code></summary></p>
<p><div class="highlight"><span class="filename">backend/blocks/github/triggers.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">GitHubTriggerBase</span><span class="o">.</span><span class="n">Input</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">EventsFilter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        https://docs.github.com/en/webhooks/webhook-events-and-payloads#pull_request</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">opened</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">edited</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">reopened</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">synchronize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">assigned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">unassigned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labeled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">unlabeled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">converted_to_draft</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">locked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">unlocked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">enqueued</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dequeued</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">milestoned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">demilestoned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ready_for_review</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">review_requested</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">review_request_removed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">auto_merge_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">auto_merge_disabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">events</span><span class="p">:</span> <span class="n">EventsFilter</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Events&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The events to subscribe to&quot;</span>
    <span class="p">)</span>
</code></pre></div>
</details></p>
<ul>
<li>The name of the input field (<code>events</code> in this case) must match <code>webhook_config.event_filter_input</code>.</li>
<li>The event filter itself must be a Pydantic model with only boolean fields.</li>
</ul>
</li>
<li>
<p><strong>Include payload field</strong> in your block's Input schema.</p>
<p><details>
<summary>Example: <code>GitHubTriggerBase</code></summary></p>
<p><div class="highlight"><span class="filename">backend/blocks/github/triggers.py</span><pre><span></span><code><span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span><span class="n">hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</code></pre></div>
</details></p>
</li>
<li>
<p><strong>Define <code>credentials</code> input</strong> in your block's Input schema.</p>
<ul>
<li>Its scopes must be sufficient to manage a user's webhooks through the provider's API</li>
<li>See <a href="#blocks-with-authentication">Blocks with authentication</a> for further details</li>
</ul>
</li>
<li>
<p><strong>Process webhook payload</strong> and output relevant parts of it in your block's <code>run</code> method.</p>
<p><details>
<summary>Example: <code>GitHubPullRequestTriggerBlock</code></summary></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
    <span class="k">yield</span> <span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span>
    <span class="k">yield</span> <span class="s2">&quot;sender&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">]</span>
    <span class="k">yield</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
    <span class="k">yield</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span>
    <span class="k">yield</span> <span class="s2">&quot;pull_request&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;pull_request&quot;</span><span class="p">]</span>
</code></pre></div>
<p>Note that the <code>credentials</code> parameter can be omitted if the credentials
aren't used at block runtime, like in the example.
</details></p>
</li>
</ol>
<h4 id="adding-a-webhooks-manager">Adding a Webhooks Manager<a class="headerlink" href="#adding-a-webhooks-manager" title="Permanent link">&para;</a></h4>
<p>To add support for a new webhook provider, you'll need to create a WebhooksManager that implements the <code>BaseWebhooksManager</code> interface:</p>
<div class="highlight"><span class="filename">backend/integrations/webhooks/_base.py</span><pre><span></span><code><span class="n">PROVIDER_NAME</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">ProviderName</span><span class="p">]</span>

<span class="nd">@abstractmethod</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">_register_webhook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span><span class="p">,</span>
    <span class="n">webhook_type</span><span class="p">:</span> <span class="n">WT</span><span class="p">,</span>
    <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">ingress_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers a new webhook with the provider.</span>

<span class="sd">    Params:</span>
<span class="sd">        credentials: The credentials with which to create the webhook</span>
<span class="sd">        webhook_type: The provider-specific webhook type to create</span>
<span class="sd">        resource: The resource to receive events for</span>
<span class="sd">        events: The events to subscribe to</span>
<span class="sd">        ingress_url: The ingress URL for webhook payloads</span>
<span class="sd">        secret: Secret used to verify webhook payloads</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Webhook ID assigned by the provider</span>
<span class="sd">        config: Provider-specific configuration for the webhook</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="nd">@classmethod</span>
<span class="nd">@abstractmethod</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">validate_payload</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">webhook</span><span class="p">:</span> <span class="n">integrations</span><span class="o">.</span><span class="n">Webhook</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates an incoming webhook request and returns its payload and type.</span>

<span class="sd">    Params:</span>
<span class="sd">        webhook: Object representing the configured webhook and its properties in our system.</span>
<span class="sd">        request: Incoming FastAPI `Request`</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The validated payload</span>
<span class="sd">        str: The event type associated with the payload</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="nd">@abstractmethod</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">_deregister_webhook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">webhook</span><span class="p">:</span> <span class="n">integrations</span><span class="o">.</span><span class="n">Webhook</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">trigger_ping</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">webhook</span><span class="p">:</span> <span class="n">integrations</span><span class="o">.</span><span class="n">Webhook</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span> <span class="o">|</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Triggers a ping to the given webhook.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: if the provider doesn&#39;t support pinging</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<p>And add a reference to your <code>WebhooksManager</code> class in <code>WEBHOOK_MANAGERS_BY_NAME</code>:</p>
<div class="highlight"><span class="filename">backend/integrations/webhooks/__init__.py</span><pre><span></span><code><span class="n">WEBHOOK_MANAGERS_BY_NAME</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="s2">&quot;ProviderName&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;BaseWebhooksManager&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">PROVIDER_NAME</span><span class="p">:</span> <span class="n">handler</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">CompassWebhookManager</span><span class="p">,</span>
        <span class="n">GithubWebhooksManager</span><span class="p">,</span>
        <span class="n">Slant3DWebhooksManager</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="example-github-webhook-integration">Example: GitHub Webhook Integration<a class="headerlink" href="#example-github-webhook-integration" title="Permanent link">&para;</a></h4>
<details>
<summary>
GitHub Webhook triggers: <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/backend/backend/blocks/github/triggers.py"><code>blocks/github/triggers.py</code></a>
</summary>

<div class="highlight"><span class="filename">backend/blocks/github/triggers.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">GitHubTriggerBase</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">GithubCredentialsInput</span> <span class="o">=</span> <span class="n">GithubCredentialsField</span><span class="p">(</span><span class="s2">&quot;repo&quot;</span><span class="p">)</span>
        <span class="n">repo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;Repository to subscribe to.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;**Note:** Make sure your GitHub credentials have permissions &quot;</span>
                <span class="s2">&quot;to create webhooks on this repo.&quot;</span>
            <span class="p">),</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{owner}</span><span class="s2">/</span><span class="si">{repo}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span><span class="n">hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>

    <span class="k">class</span> <span class="nc">Output</span><span class="p">(</span><span class="n">BlockSchema</span><span class="p">):</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The complete webhook payload that was received from GitHub. &quot;</span>
            <span class="s2">&quot;Includes information about the affected resource (e.g. pull request), &quot;</span>
            <span class="s2">&quot;the event, and the user who triggered the event.&quot;</span>
        <span class="p">)</span>
        <span class="n">triggered_by_user</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Object representing the GitHub user who triggered the event&quot;</span>
        <span class="p">)</span>
        <span class="n">error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Error message if the payload could not be processed&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
        <span class="k">yield</span> <span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span>
        <span class="k">yield</span> <span class="s2">&quot;triggered_by_user&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">GithubPullRequestTriggerBlock</span><span class="p">(</span><span class="n">GitHubTriggerBase</span><span class="p">,</span> <span class="n">Block</span><span class="p">):</span>
    <span class="n">EXAMPLE_PAYLOAD_FILE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;example_payloads&quot;</span> <span class="o">/</span> <span class="s2">&quot;pull_request.synchronize.json&quot;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">GitHubTriggerBase</span><span class="o">.</span><span class="n">Input</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">EventsFilter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            https://docs.github.com/en/webhooks/webhook-events-and-payloads#pull_request</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">opened</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">edited</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">reopened</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">synchronize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">assigned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">unassigned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">labeled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">unlabeled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">converted_to_draft</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">locked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">unlocked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">enqueued</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">dequeued</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">milestoned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">demilestoned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ready_for_review</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">review_requested</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">review_request_removed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">auto_merge_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">auto_merge_disabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">events</span><span class="p">:</span> <span class="n">EventsFilter</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Events&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The events to subscribe to&quot;</span>
        <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Output</span><span class="p">(</span><span class="n">GitHubTriggerBase</span><span class="o">.</span><span class="n">Output</span><span class="p">):</span>
        <span class="n">event</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The PR event that triggered the webhook (e.g. &#39;opened&#39;)&quot;</span>
        <span class="p">)</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of the affected pull request&quot;</span><span class="p">)</span>
        <span class="n">pull_request</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Object representing the affected pull request&quot;</span>
        <span class="p">)</span>
        <span class="n">pull_request_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SchemaField</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The URL of the affected pull request&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">backend.integrations.webhooks.github</span> <span class="kn">import</span> <span class="n">GithubWebhookType</span>

        <span class="n">example_payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EXAMPLE_PAYLOAD_FILE</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;6c60ec01-8128-419e-988f-96a063ee2fea&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;This block triggers on pull request events and outputs the event type and payload.&quot;</span><span class="p">,</span>
            <span class="n">categories</span><span class="o">=</span><span class="p">{</span><span class="n">BlockCategory</span><span class="o">.</span><span class="n">DEVELOPER_TOOLS</span><span class="p">,</span> <span class="n">BlockCategory</span><span class="o">.</span><span class="n">INPUT</span><span class="p">},</span>
            <span class="n">input_schema</span><span class="o">=</span><span class="n">GithubPullRequestTriggerBlock</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span>
            <span class="n">output_schema</span><span class="o">=</span><span class="n">GithubPullRequestTriggerBlock</span><span class="o">.</span><span class="n">Output</span><span class="p">,</span>
            <span class="n">webhook_config</span><span class="o">=</span><span class="n">BlockWebhookConfig</span><span class="p">(</span>
                <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;github&quot;</span><span class="p">,</span>
                <span class="n">webhook_type</span><span class="o">=</span><span class="n">GithubWebhookType</span><span class="o">.</span><span class="n">REPO</span><span class="p">,</span>
                <span class="n">resource_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{repo}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">event_filter_input</span><span class="o">=</span><span class="s2">&quot;events&quot;</span><span class="p">,</span>
                <span class="n">event_format</span><span class="o">=</span><span class="s2">&quot;pull_request.</span><span class="si">{event}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">test_input</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;repo&quot;</span><span class="p">:</span> <span class="s2">&quot;Significant-Gravitas/AutoGPT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;opened&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;synchronize&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="s2">&quot;credentials&quot;</span><span class="p">:</span> <span class="n">TEST_CREDENTIALS_INPUT</span><span class="p">,</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">example_payload</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">test_credentials</span><span class="o">=</span><span class="n">TEST_CREDENTIALS</span><span class="p">,</span>
            <span class="n">test_output</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="n">example_payload</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;triggered_by_user&quot;</span><span class="p">,</span> <span class="n">example_payload</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="n">example_payload</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">example_payload</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;pull_request&quot;</span><span class="p">,</span> <span class="n">example_payload</span><span class="p">[</span><span class="s2">&quot;pull_request&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;pull_request_url&quot;</span><span class="p">,</span> <span class="n">example_payload</span><span class="p">[</span><span class="s2">&quot;pull_request&quot;</span><span class="p">][</span><span class="s2">&quot;html_url&quot;</span><span class="p">]),</span>
            <span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="k">yield from</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s2">&quot;pull_request&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;pull_request&quot;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s2">&quot;pull_request_url&quot;</span><span class="p">,</span> <span class="n">input_data</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;pull_request&quot;</span><span class="p">][</span><span class="s2">&quot;html_url&quot;</span><span class="p">]</span>
</code></pre></div>
</details>

<details>
<summary>
GitHub Webhooks Manager: <a href="https://github.com/Significant-Gravitas/AutoGPT/blob/master/autogpt_platform/backend/backend/integrations/webhooks/github.py"><code>integrations/webhooks/github.py</code></a>
</summary>

<div class="highlight"><span class="filename">backend/integrations/webhooks/github.py</span><pre><span></span><code><span class="k">class</span> <span class="nc">GithubWebhookType</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="n">REPO</span> <span class="o">=</span> <span class="s2">&quot;repo&quot;</span>


<span class="k">class</span> <span class="nc">GithubWebhooksManager</span><span class="p">(</span><span class="n">BaseWebhooksManager</span><span class="p">):</span>
    <span class="n">PROVIDER_NAME</span> <span class="o">=</span> <span class="n">ProviderName</span><span class="o">.</span><span class="n">GITHUB</span>

    <span class="n">WebhookType</span> <span class="o">=</span> <span class="n">GithubWebhookType</span>

    <span class="n">GITHUB_API_URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.github.com&quot;</span>
    <span class="n">GITHUB_API_DEFAULT_HEADERS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github.v3+json&quot;</span><span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">validate_payload</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">webhook</span><span class="p">:</span> <span class="n">integrations</span><span class="o">.</span><span class="n">Webhook</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">event_type</span> <span class="o">:=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-GitHub-Event&quot;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;X-GitHub-Event header is missing!&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">signature_header</span> <span class="o">:=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Hub-Signature-256&quot;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">403</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;X-Hub-Signature-256 header is missing!&quot;</span>
            <span class="p">)</span>

        <span class="n">payload_body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
        <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="n">webhook</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">payload_body</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
        <span class="p">)</span>
        <span class="n">expected_signature</span> <span class="o">=</span> <span class="s2">&quot;sha256=&quot;</span> <span class="o">+</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">expected_signature</span><span class="p">,</span> <span class="n">signature_header</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">403</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Request signatures didn&#39;t match!&quot;</span>
            <span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">:=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">):</span>
            <span class="n">event_type</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">payload</span><span class="p">,</span> <span class="n">event_type</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">trigger_ping</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">webhook</span><span class="p">:</span> <span class="n">integrations</span><span class="o">.</span><span class="n">Webhook</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Credentials are required but were not passed&quot;</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">GITHUB_API_DEFAULT_HEADERS</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">auth_header</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="n">repo</span><span class="p">,</span> <span class="n">github_hook_id</span> <span class="o">=</span> <span class="n">webhook</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="n">webhook</span><span class="o">.</span><span class="n">provider_webhook_id</span>
        <span class="n">ping_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">GITHUB_API_URL</span><span class="si">}</span><span class="s2">/repos/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/hooks/</span><span class="si">{</span><span class="n">github_hook_id</span><span class="si">}</span><span class="s2">/pings&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">ping_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">204</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="n">extract_github_error_msg</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to ping GitHub webhook: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_register_webhook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span><span class="p">,</span>
        <span class="n">webhook_type</span><span class="p">:</span> <span class="n">GithubWebhookType</span><span class="p">,</span>
        <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">ingress_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">webhook_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">WebhookType</span><span class="o">.</span><span class="n">REPO</span> <span class="ow">and</span> <span class="n">resource</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid repo format: expected &#39;owner/repo&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Extract main event, e.g. `pull_request.opened` -&gt; `pull_request`</span>
        <span class="n">github_events</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">event</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">})</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">GITHUB_API_DEFAULT_HEADERS</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">auth_header</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">webhook_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
            <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="n">github_events</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">ingress_url</span><span class="p">,</span>
                <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;insecure_ssl&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="n">secret</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">GITHUB_API_URL</span><span class="si">}</span><span class="s2">/repos/</span><span class="si">{</span><span class="n">resource</span><span class="si">}</span><span class="s2">/hooks&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">webhook_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">201</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="n">extract_github_error_msg</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;not found&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;(Make sure the GitHub account or API key has &#39;repo&#39; or &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;webhook create permissions to &#39;</span><span class="si">{</span><span class="n">resource</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
                <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create GitHub webhook: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">webhook_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">webhook_id</span><span class="p">),</span> <span class="n">config</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_deregister_webhook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">webhook</span><span class="p">:</span> <span class="n">integrations</span><span class="o">.</span><span class="n">Webhook</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Credentials</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">webhook_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WebhookType</span><span class="p">(</span><span class="n">webhook</span><span class="o">.</span><span class="n">webhook_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">webhook</span><span class="o">.</span><span class="n">credentials_id</span> <span class="o">!=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Webhook #</span><span class="si">{</span><span class="n">webhook</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> does not belong to credentials </span><span class="si">{</span><span class="n">credentials</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">GITHUB_API_DEFAULT_HEADERS</span><span class="p">,</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">auth_header</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">webhook_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">WebhookType</span><span class="o">.</span><span class="n">REPO</span><span class="p">:</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">webhook</span><span class="o">.</span><span class="n">resource</span>
            <span class="n">delete_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">GITHUB_API_URL</span><span class="si">}</span><span class="s2">/repos/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/hooks/</span><span class="si">{</span><span class="n">webhook</span><span class="o">.</span><span class="n">provider_webhook_id</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unsupported webhook type &#39;</span><span class="si">{</span><span class="n">webhook</span><span class="o">.</span><span class="n">webhook_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">404</span><span class="p">]:</span>
            <span class="c1"># 204 means successful deletion, 404 means the webhook was already deleted</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="n">extract_github_error_msg</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete GitHub webhook: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If we reach here, the webhook was successfully deleted or didn&#39;t exist</span>
</code></pre></div>
</details>

<h2 id="key-points-to-remember">Key Points to Remember<a class="headerlink" href="#key-points-to-remember" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Unique ID</strong>: Give your block a unique ID in the <strong>init</strong> method.</li>
<li><strong>Input and Output Schemas</strong>: Define clear input and output schemas.</li>
<li><strong>Error Handling</strong>: Implement error handling in the <code>run</code> method.</li>
<li><strong>Output Results</strong>: Use <code>yield</code> to output results in the <code>run</code> method.</li>
<li><strong>Testing</strong>: Provide test input and output in the <strong>init</strong> method for automatic testing.</li>
</ul>
<h2 id="understanding-the-testing-process">Understanding the Testing Process<a class="headerlink" href="#understanding-the-testing-process" title="Permanent link">&para;</a></h2>
<p>The testing of blocks is handled by <code>test_block.py</code>, which does the following:</p>
<ol>
<li>It calls the block with the provided <code>test_input</code>.
   If the block has a <code>credentials</code> field, <code>test_credentials</code> is passed in as well.</li>
<li>If a <code>test_mock</code> is provided, it temporarily replaces the specified methods with the mock functions.</li>
<li>It then asserts that the output matches the <code>test_output</code>.</li>
</ol>
<p>For the WikipediaSummaryBlock:</p>
<ul>
<li>The test will call the block with the topic "Artificial Intelligence".</li>
<li>Instead of making a real API call, it will use the mock function, which returns <code>{"extract": "summary content"}</code>.</li>
<li>It will then check if the output key is "summary" and its value is a string.</li>
</ul>
<p>This approach allows us to test the block's logic comprehensively without relying on external services, while also accommodating non-deterministic outputs.</p>
<h2 id="security-best-practices-for-ssrf-prevention">Security Best Practices for SSRF Prevention<a class="headerlink" href="#security-best-practices-for-ssrf-prevention" title="Permanent link">&para;</a></h2>
<p>When creating blocks that handle external URL inputs or make network requests, it's crucial to use the platform's built-in SSRF protection mechanisms. The <code>backend.util.request</code> module provides a secure <code>Requests</code> wrapper class that should be used for all HTTP requests.</p>
<h3 id="using-the-secure-requests-wrapper">Using the Secure Requests Wrapper<a class="headerlink" href="#using-the-secure-requests-wrapper" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">backend.util.request</span> <span class="kn">import</span> <span class="n">requests</span>

<span class="k">class</span> <span class="nc">MyNetworkBlock</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockOutput</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># The requests wrapper automatically validates URLs and blocks dangerous requests</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">input_data</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">yield</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># URL validation failed</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid URL provided: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Request failed</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The <code>Requests</code> wrapper provides these security features:</p>
<ol>
<li>
<p><strong>URL Validation</strong>:</p>
<ul>
<li>Blocks requests to private IP ranges (RFC 1918)</li>
<li>Validates URL format and protocol</li>
<li>Resolves DNS and checks IP addresses</li>
<li>Supports whitelisting trusted origins</li>
</ul>
</li>
<li>
<p><strong>Secure Defaults</strong>:</p>
<ul>
<li>Disables redirects by default</li>
<li>Raises exceptions for non-200 status codes</li>
<li>Supports custom headers and validators</li>
</ul>
</li>
<li>
<p><strong>Protected IP Ranges</strong>:
   The wrapper denies requests to these networks:</p>
<div class="highlight"><span class="filename">backend/util/request.py</span><pre><span></span><code><span class="c1"># IPv4 Ranges</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;0.0.0.0/8&quot;</span><span class="p">),</span>  <span class="c1"># &quot;This&quot; Network</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">),</span>  <span class="c1"># Private-Use</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;127.0.0.0/8&quot;</span><span class="p">),</span>  <span class="c1"># Loopback</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;169.254.0.0/16&quot;</span><span class="p">),</span>  <span class="c1"># Link Local</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;172.16.0.0/12&quot;</span><span class="p">),</span>  <span class="c1"># Private-Use</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;192.168.0.0/16&quot;</span><span class="p">),</span>  <span class="c1"># Private-Use</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;224.0.0.0/4&quot;</span><span class="p">),</span>  <span class="c1"># Multicast</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;240.0.0.0/4&quot;</span><span class="p">),</span>  <span class="c1"># Reserved for Future Use</span>
<span class="c1"># IPv6 Ranges</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;::1/128&quot;</span><span class="p">),</span>  <span class="c1"># Loopback</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;fc00::/7&quot;</span><span class="p">),</span>  <span class="c1"># Unique local addresses (ULA)</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;fe80::/10&quot;</span><span class="p">),</span>  <span class="c1"># Link-local</span>
<span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;ff00::/8&quot;</span><span class="p">),</span>  <span class="c1"># Multicast</span>
</code></pre></div>
</li>
</ol>
<h3 id="custom-request-configuration">Custom Request Configuration<a class="headerlink" href="#custom-request-configuration" title="Permanent link">&para;</a></h3>
<p>If you need to customize the request behavior:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">backend.util.request</span> <span class="kn">import</span> <span class="n">Requests</span>

<span class="c1"># Create a custom requests instance with specific trusted origins</span>
<span class="n">custom_requests</span> <span class="o">=</span> <span class="n">Requests</span><span class="p">(</span>
    <span class="n">trusted_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api.trusted-service.com&quot;</span><span class="p">],</span>
    <span class="n">raise_for_status</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">extra_headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;MyBlock/1.0&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="tips-for-effective-block-testing">Tips for Effective Block Testing<a class="headerlink" href="#tips-for-effective-block-testing" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Provide realistic test_input</strong>: Ensure your test input covers typical use cases.</p>
</li>
<li>
<p><strong>Define appropriate test_output</strong>:</p>
<ul>
<li>For deterministic outputs, use specific expected values.</li>
<li>For non-deterministic outputs or when only the type matters, use Python types (e.g., <code>str</code>, <code>int</code>, <code>dict</code>).</li>
<li>You can mix specific values and types, e.g., <code>("key1", str), ("key2", 42)</code>.</li>
</ul>
</li>
<li>
<p><strong>Use test_mock for network calls</strong>: This prevents tests from failing due to network issues or API changes.</p>
</li>
<li>
<p><strong>Consider omitting test_mock for blocks without external dependencies</strong>: If your block doesn't make network calls or use external resources, you might not need a mock.</p>
</li>
<li>
<p><strong>Consider edge cases</strong>: Include tests for potential error conditions in your <code>run</code> method.</p>
</li>
<li>
<p><strong>Update tests when changing block behavior</strong>: If you modify your block, ensure the tests are updated accordingly.</p>
</li>
</ol>
<p>By following these steps, you can create new blocks that extend the functionality of the AutoGPT Agent Server.</p>
<h2 id="blocks-we-want-to-see">Blocks we want to see<a class="headerlink" href="#blocks-we-want-to-see" title="Permanent link">&para;</a></h2>
<p>Below is a list of blocks that we would like to see implemented in the AutoGPT Agent Server. If you're interested in contributing, feel free to pick one of these blocks or chose your own.</p>
<p>If you would like to implement one of these blocks, open a pull request and we will start the review process.</p>
<h3 id="consumer-servicesplatforms">Consumer Services/Platforms<a class="headerlink" href="#consumer-servicesplatforms" title="Permanent link">&para;</a></h3>
<ul>
<li>Google sheets - <a href="https://github.com/Significant-Gravitas/AutoGPT/pull/8236"><del>Read/Append</del></a></li>
<li>Email - Read/Send with <a href="https://github.com/Significant-Gravitas/AutoGPT/pull/8236"><del>Gmail</del></a>, Outlook, Yahoo, Proton, etc</li>
<li>Calendar - Read/Write with Google Calendar, Outlook Calendar, etc</li>
<li>Home Assistant - Call Service, Get Status</li>
<li>Dominos - Order Pizza, Track Order</li>
<li>Uber - Book Ride, Track Ride</li>
<li>Notion - Create/Read Page, Create/Append/Read DB</li>
<li>Google drive - read/write/overwrite file/folder</li>
</ul>
<h3 id="social-media">Social Media<a class="headerlink" href="#social-media" title="Permanent link">&para;</a></h3>
<ul>
<li>Twitter - Post, Reply, Get Replies, Get Comments, Get Followers, Get Following, Get Tweets, Get Mentions</li>
<li>Instagram - Post, Reply, Get Comments, Get Followers, Get Following, Get Posts, Get Mentions, Get Trending Posts</li>
<li>TikTok - Post, Reply, Get Comments, Get Followers, Get Following, Get Videos, Get Mentions, Get Trending Videos</li>
<li>LinkedIn - Post, Reply, Get Comments, Get Followers, Get Following, Get Posts, Get Mentions, Get Trending Posts</li>
<li>YouTube - Transcribe Videos/Shorts, Post Videos/Shorts, Read/Reply/React to Comments, Update Thumbnails, Update Description, Update Tags, Update Titles, Get Views, Get Likes, Get Dislikes, Get Subscribers, Get Comments, Get Shares, Get Watch Time, Get Revenue, Get Trending Videos, Get Top Videos, Get Top Channels</li>
<li>Reddit - Post, Reply, Get Comments, Get Followers, Get Following, Get Posts, Get Mentions, Get Trending Posts</li>
<li>Treatwell (and related Platforms) - Book, Cancel, Review, Get Recommendations</li>
<li>Substack - Read/Subscribe/Unsubscribe, Post/Reply, Get Recommendations</li>
<li>Discord - Read/Post/Reply, Moderation actions</li>
<li>GoodReads - Read/Post/Reply, Get Recommendations</li>
</ul>
<h3 id="e-commerce">E-commerce<a class="headerlink" href="#e-commerce" title="Permanent link">&para;</a></h3>
<ul>
<li>Airbnb - Book, Cancel, Review, Get Recommendations</li>
<li>Amazon - Order, Track Order, Return, Review, Get Recommendations</li>
<li>eBay - Order, Track Order, Return, Review, Get Recommendations</li>
<li>Upwork - Post Jobs, Hire Freelancer, Review Freelancer, Fire Freelancer</li>
</ul>
<h3 id="business-tools">Business Tools<a class="headerlink" href="#business-tools" title="Permanent link">&para;</a></h3>
<ul>
<li>External Agents - Call other agents similar to AutoGPT</li>
<li>Trello - Create/Read/Update/Delete Cards, Lists, Boards</li>
<li>Jira - Create/Read/Update/Delete Issues, Projects, Boards</li>
<li>Linear - Create/Read/Update/Delete Issues, Projects, Boards</li>
<li>Excel - Read/Write/Update/Delete Rows, Columns, Sheets</li>
<li>Slack - Read/Post/Reply to Messages, Create Channels, Invite Users</li>
<li>ERPNext - Create/Read/Update/Delete Invoices, Orders, Customers, Products</li>
<li>Salesforce - Create/Read/Update/Delete Leads, Opportunities, Accounts</li>
<li>HubSpot - Create/Read/Update/Delete Contacts, Deals, Companies</li>
<li>Zendesk - Create/Read/Update/Delete Tickets, Users, Organizations</li>
<li>Odoo - Create/Read/Update/Delete Sales Orders, Invoices, Customers</li>
<li>Shopify - Create/Read/Update/Delete Products, Orders, Customers</li>
<li>WooCommerce - Create/Read/Update/Delete Products, Orders, Customers</li>
<li>Squarespace - Create/Read/Update/Delete Pages, Products, Orders</li>
</ul>
<h2 id="agent-templates-we-want-to-see">Agent Templates we want to see<a class="headerlink" href="#agent-templates-we-want-to-see" title="Permanent link">&para;</a></h2>
<h3 id="datainformation">Data/Information<a class="headerlink" href="#datainformation" title="Permanent link">&para;</a></h3>
<ul>
<li>Summarize top news of today, of this week, this month via Apple News or other large media outlets BBC, TechCrunch, hackernews, etc</li>
<li>Create, read, and summarize substack newsletters or any newsletters (blog writer vs blog reader)</li>
<li>Get/read/summarize the most viral Twitter, Instagram, TikTok (general social media accounts) of the day, week, month</li>
<li>Get/Read any LinkedIn posts or profile that mention AI Agents</li>
<li>Read/Summarize discord (might not be able to do this because you need access)</li>
<li>Read / Get most read books in a given month, year, etc from GoodReads or Amazon Books, etc</li>
<li>Get dates for specific shows across all streaming services</li>
<li>Suggest/Recommend/Get most watched shows in a given month, year, etc across all streaming platforms</li>
<li>Data analysis from xlsx data set</li>
<li>Gather via Excel or Google Sheets data &gt; Sample the data randomly (sample block takes top X, bottom X, randomly, etc) &gt; pass that to LLM Block to generate a script for analysis of the full data &gt; Python block to run the script&gt; making a loop back through LLM Fix Block on error &gt; create chart/visualization (potentially in the code block?) &gt; show the image as output (this may require frontend changes to show)</li>
<li>Tiktok video search and download</li>
</ul>
<h3 id="marketing">Marketing<a class="headerlink" href="#marketing" title="Permanent link">&para;</a></h3>
<ul>
<li>Portfolio site design and enhancements</li>
</ul>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "navigation.top", "navigation.tracking", "navigation.tabs", "toc.follow", "toc.integrate", "content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../_javascript/tablesort.js"></script>
      
        <script src="../../_javascript/mathjax.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9718108884365672"></script>
      
    
  </body>
</html>